<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Cropper.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css" />

    <!-- Cropper.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

</head>

<body>
    <div class="container body-wrapper">
        <h4 id="title" align="center"><span class="en">Select pix for upload</span></h4>
        <div style="margin-top: -10px;">Recommended Dimension: 480px by 360px (Portrait)</div>
        
        <!-- Cropper.js container -->
        <div id="cropper-container" style="display: none;">
            <img id="cropper-image" src="" alt="Crop Image">
            <button id="crop-button" class="btn btn-primary">Crop and Upload</button>
        </div>
        
        <!-- File Upload Form -->
        <form id="fileupload" action="" method="POST" enctype="multipart/form-data">
            <!-- Other form elements -->
            <span class="btn btn-primary fileinput-button" style="margin: 5px auto !important; float:right;">
                <i class="fa fa-camera"></i>
                <span></span>
                <input type="file" name="files[]" multiple />
            </span>
            <span class="fileupload-process"></span>
            <div class="col-lg-5 fileupload-progress fade">
                <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                </div>
            </div>
            <table role="presentation" align="center">
                <tbody align="center" class="files"></tbody>
            </table>
        </form>
    </div>
   
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/vendor/jquery.ui.widget.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-load-image/5.16.0/load-image.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-canvas-to-blob/3.28.0/js/canvas-to-blob.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/jquery.iframe-transport.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/jquery.fileupload.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/jquery.fileupload-process.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/jquery.fileupload-image.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/jquery.fileupload-audio.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/jquery.fileupload-video.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.32.0/js/jquery.fileupload-validate.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
        $(function () {
    var cropper;
    var croppedCanvas;

    // Initialize the jQuery File Upload widget:
    $('#fileupload').fileupload({
        // Other options...
        add: function (e, data) {
            var file = data.files[0];
            if (file && /^image\/\w+/.test(file.type)) {
                var reader = new FileReader();
                reader.onload = function () {
                    $('#cropper-image').attr('src', reader.result);
                    $('#cropper-container').show();

                    cropper = new Cropper(document.getElementById('cropper-image'), {
                        aspectRatio: 4 / 3,
                        autoCropArea: 1,
                        viewMode: 1,
                        responsive: true,
                    });
                };
                reader.readAsDataURL(file);

                $('#crop-button').off('click').on('click', function () {
                    croppedCanvas = cropper.getCroppedCanvas({
                        width: 480,
                        height: 360
                    });
                    croppedCanvas.toBlob(function (blob) {
                        data.files[0] = blob;
                        $('#cropper-container').hide();
                        cropper.destroy();
                        $('#fileupload').fileupload('send', data);
                    }, file.type);
                });
            } else {
                data.submit();
            }
        },
        // Other options...
    });

    $('#fileupload').fileupload('option', 'redirect', window.location.href.replace(/\/[^/]*$/, '/cors/result.html?%s'));

    if (window.location.hostname === 'blueimp.github.io') {
        // Demo settings:
        $('#fileupload').fileupload('option', {
            url: '//jquery-file-upload.appspot.com/',
            // Other options...
            disableImageResize: /Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),
            maxFileSize: 10485760,
            previewCrop: true,
            autoUpload: true,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        });

        if ($.support.cors) {
            $.ajax({
                url: 'https://quantumcloud.ng/techcamp2024/api/imagesOptionsEdit/?email=' + localStorage.email + '&dir=' + localStorage.dir,
                type: 'HEAD',
            }).fail(function () {
                $('<div class="alert alert-danger"/>').text('Upload server currently unavailable - ' + new Date()).appendTo('#fileupload');
            });
        }
    } else {
        $('#fileupload').addClass('fileupload-processing');
        $.ajax({
            url: $('#fileupload').fileupload('option', 'url'),
            dataType: 'json',
            context: $('#fileupload')[0],
        }).always(function () {
            $(this).removeClass('fileupload-processing');
        }).done(function (result) {
            $(this).fileupload('option', 'done').call(this, $.Event('done'), { result: result });
        });
    }
  
    // Global variables
    var status = new Array(), // Create a new array
        successAll = true; // Used to check for successful upload

    // After you've initialized the jQuery File Upload widget:
    $('#fileupload') // Replace with your form id
        .bind('fileuploaddone', function (e, data) {
            // Append the file response data to the global array, in my case "status"   
            //status.push( jQuery.parseJSON(data.jqXHR.responseText) );
            //alert("ok");
            location.href = 'option-banner.html';
        })
        .bind('fileuploadstop', function (e) {
            for (var i = 0; i < status.length; i++) {
                var error = status[i].files[0].error;

                if (error) {
                    $('#error').show();
                    $('#error').append('<p><em>Error given: ' + error + '</em></p>');

                    successAll = false; // Change success value to false if error
                }
            }   

            // If successAll is true, meaning it wasn't reset because of an error,
            // display success message.
            if (successAll) {
                $('#success').show();
            }   
            status = new Array();       
        });
});

    </script>
    
</body>

</html>